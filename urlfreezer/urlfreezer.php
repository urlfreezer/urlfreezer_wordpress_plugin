<?php
/*
Plugin Name: URL Freezer
Description: Integrates URL Freezer with your website
Version:     1.0.0
Author:      URL Freezer
Author URI:  http://urlfreezer.com
Text Domain: urlfreezer
*/

defined( 'ABSPATH' ) or die;

define( 'URLFREEZER_VER', '1.0.0' );
define( 'URLFREEZER_FILE', __FILE__ );
define( 'URLFREEZER_DIR_PATH', plugin_dir_path( __FILE__ ) );

if ( ! class_exists( 'URLFreezer' ) ) {
	class URLFreezer {
		public static function get_instance() {
			if ( self::$instance == null ) {
				self::$instance = new self();
			}
			return self::$instance;
		}

		private static $instance = null;

		private function __clone() { }

		private function __wakeup() { }

		private function __construct() {
			// Actions
			add_action( 'admin_init', array( $this, 'register_settings' ) );
			add_action( 'admin_menu', array( $this, 'add_admin_menu' ) );
			add_action( 'wp_footer', array( $this, 'add_script' ) );
		}

		public function register_settings() {
			register_setting( 'urlfreezer_optsgroup', 'urlfreezer_enabled' );
			register_setting( 'urlfreezer_optsgroup', 'urlfreezer_id' );
		}

		public function add_admin_menu() {
			add_menu_page(
				__( 'URL Freezer', 'urlfreezer' ),
				__( 'URL Freezer', 'urlfreezer' ),
				'manage_options',
				'urlfreezer',
				array( $this, 'render_options_page' ),
				'data:image/svg+xml;base64,'.base64_encode('<?xml version="1.0" encoding="UTF-8"?><svg id="svg12" width="1200.3" height="1200.6" enable-background="new 0 0 1000 1000" version="1.1" viewBox="0 0 1200.3 1200.6" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"><g id="g10" transform="translate(82.369 -98.659)"><g id="g8" transform="matrix(.1 0 0 -.1 0 512)"><path fill="black" id="rect924" transform="matrix(10 0 0 -10 -1227.6 4722.4)" d="m542.15 108.9c-250.28 0-451.76 201.49-451.76 451.76v197.11c0 250.28 201.48 451.76 451.76 451.76h196.79c250.28 0 451.76-201.48 451.76-451.76v-197.11c0-250.28-201.48-451.76-451.76-451.76zm317.84 144.16s127.29 6.0439 141.95 8.5781c10.514 1.9013 6.6777 12.398 6.6777 12.398l-49.217 131.95s-4.5137 17.844-11.846 6.1953c-7.3373-11.742-25.137-39.939-25.137-39.939s-7.5947 4.7784-19.238 12.059c-5.3615 3.3826-27.92 17.576-39.725 25.01 60.949 30.241 96.402 91.154 93.293 161.82-0.69388 15.98-9.5811 49.88-16.65 64.5-15.226 30.789-34.579 54.145-61.322 74.189-5.9719 4.3831-44.409 29.081-87.623 56.293 16.669 26.206 34.012 53.504 43.936 69.352 6.9968 10.956 11.506 18.123 11.506 18.123s29.274-18.376 41.412-26.066c12.125-7.6315 7.6816 9.9688 7.6816 9.9688l-18.789 136.63s-1.639 10.883-11.971 8.5938c-14.265-3.3502-130.83-46.496-130.83-46.496s-18.132-4.149-3.3809-13.434l38.246-24.072s-4.0694-6.3845-10.252-16.287c-9.5937-15.202-26.971-42.535-43.727-68.891-31.563 18.972-41.08 22.579-59.113 27.551-75.962 20.733-155.77-7.4792-196.07-69.529-8.1042-12.256-9.6334-21.759-6.0039-35.818 2.4312-9.418 3.6243-11.899 8.3613-17.484 6.382-7.712 18.992-15.577 28.039-17.629 10.458-2.1902 21.058-0.68783 30.729 4.4199 6.7635 3.6026 9.9585 6.6527 17.352 16.336 16.675 21.622 30.752 30.424 55.783 35.104 13.252 2.4144 17.57 2.7012 27.072 1.5488 22.832-2.7833 23.457-3.0655 120.36-64.469 96.992-61.237 97.349-61.572 109.81-81.113 5.3072-8.3212 6.7318-11.704 10.361-25.764 3.5965-13.932 4.0051-17.646 3.293-27.125-3.5514-49.567-46.167-84.03-96.814-78.334-19.276 2.1359-27.133 5.5296-66.217 29.754-11.497 7.2343-34.949 21.99-39.076 24.588 0 0-2.0406 2.059-4.9102 1.7598-2.1156 1.131-3.5456 1.8174-3.9336 1.8379-1.9627 0.16626-10.106-2.8884-20.66-7.7637-22.812-10.615-32.13-13.897-56.338-19.633-16.717-3.8928-20.12-5.0834-20.697-7.0938-0.65157-1.7494-0.12159-3.2714 1.6582-5.3652 3.6003-3.858 100.81-64.755 134.54-84.59 64.232-40.425 142.13-89.447 163.79-103.04 10.449-6.6253 17.26-10.863 17.26-10.863l-23.195-36.854c-3.6435-5.7888-2.7358-8.6737-0.375-10.059 3.4504-2.024 10.006-0.84571 10.006-0.84571zm-299.23 288.09c54.668 4.2852 104.22 32.631 132.32 75.953 8.1042 12.256 9.6353 21.759 6.0059 35.818-2.3982 9.2902-3.6226 11.894-8.3613 17.486-6.787 8.1708-16.959 14.612-27.42 17.338-6.9217 1.7829-9.6699 1.7973-19.191-0.16797-13.971-2.8209-18.639-6.0211-30.297-20.994-15.432-20.027-30.911-29.776-54.34-34.281-22.248-4.2785-40.657-1.5922-61.793 8.9668-6.1643 3.1501-48.359 29.297-93.57 58.111-89.085 56.664-90.625 57.859-102.4 76.855-3.4972 5.5553-7.5245 14.255-9.5527 20.502-9.0897 27.774-3.1125 60.474 14.811 80.98 19.555 22.176 47.929 33.049 77.773 29.715 19.953-2.2567 27.434-5.6997 70.32-32.391l39.428-24.51 5.8906 1.1348c3.2758 0.62997 8.2768 2.5428 11.15 4.1758 12.602 7.571 34.838 15.64 56.395 20.463 11.808 2.6804 22.67 5.3075 24.01 5.9746 3.861 1.5545 3.7812 5.0558-0.29883 9.1504-6.6469 6.5737-131.74 84.068-144.87 89.672-24.864 10.654-51.279 16.138-79.15 16.604-15.984 0.17431-50.528-6.4692-65.699-12.635-68.582-28.088-109.86-93.298-105.87-167.28 0.92428-16.345 9.7155-50.398 16.719-64.762 15.233-30.787 34.586-54.145 61.459-74.164 8.8679-6.6479 44.23-29.35 82.352-53.303 49.013-30.796 102.59-63.659 110.28-67.129 30.149-13.564 63.318-19.641 93.893-17.285z"/></g></g></svg>')
			);
		}

		public function render_options_page() {
			require( __DIR__ . '/options.php' );
		}


		public function add_script() {
			$enabled = trim( get_option( 'urlfreezer_enabled' ) );
			if ( $enabled  == '' ) return;

			$user_id = trim( get_option( 'urlfreezer_id' ) );
			if ( $user_id == '' ) return;

			require_once( URLFREEZER_DIR_PATH . 'snippet.php' );
		}
	}
}
URLFreezer::get_instance();
